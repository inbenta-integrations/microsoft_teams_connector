### OBJECTIVE
This template has been implemented in order to develop Microsoft Teams bots that consume from the
Inbenta Chatbot API with the minimum configuration and effort.
It uses some libraries to connect the Chatbot API with Microsoft Teams API.

The main library of this template is Microsoft Teams Connector, which extends from a base library named
[Chatbot API Connector](https://github.com/inbenta-integrations/chatbot_api_connector),
built to be used as a base for different external services like Skype, Line, etc.

This template includes **/conf** and **/lang** folders, which have all the configuration and
translations required by the libraries, and a small file **server.php** which creates a
TeamsConnectorâ€™s instance in order to handle all the incoming requests.

### FUNCTIONALITIES
This bot template inherits the functionalities from the `ChatbotConnector` library.

Currently, the features provided by this application are:

* Simple answers
* Multiple options with a limit of 3 elements
* Polar questions
* Chained answers
* Content ratings (yes/no + comment)
* Escalate to HyperChat after a number of no-results answers
* Escalate to HyperChat after a number of negative ratings
* Escalate to HyperChat when matching with an 'Escalation FAQ'
* Send information to webhook through forms
* Custom FAQ title in button when displaying multiple options

### HOW TO CUSTOMIZE

**Custom Behaviors**

If you need to customize the bot flow, you need to modify the class MicrosoftTeamsConnector.php. 
This class extends from the ChatbotConnector and here you can override all the parent methods.

**STRUCTURE**

The MicrosoftTeamsConnector folder has some classes needed to use the ChatbotConnector with Teams. 
These classes are used in the MicrosoftTeamsConnector constructor in order to provide the application 
with the components needed to send information to Teams and to parse messages between Teams, 
ChatbotAPI and HyperChat.

**External API folder**

Inside this folder there is the Microsoft Teams API client which allows the bot to send messages and 
handle authorization events.

**External Digester folder**

This folder contains the class MicrosoftTeamsDigester. This class is a kind of "translator" between 
the Chatbot API and Teams. Mainly, the work performed by this class is to convert a message 
from the Chatbot API into a message accepted by the Microsoft Teams API. 

It also does the inverse work, translating messages from Teams into the format required by the 
Chatbot API.

**HyperChat API**

The class MicrosoftTeamsHyperChatClient instantiates a Teams client from the external_id parameter 
provided by HyperChat. This parameter is generated by the external client and passed to HyperChat 
when the chat is created. This parameter allows us to instantiate a new Teams client from 
Microsoft Teams user_id that is extracted from the external_id:

```php
//Instances an external client
protected function instanceExternalClient($externalId, $appConf){
    $externalId = MicrosoftTeamsAPIClient::getIdFromExternalId($externalId);
    if (is_null($externalId)) {
        return null;
    }
    $externalClient = new MicrosoftTeamsAPIClient(null, $appConf, $sessionManager);
    $externalClient->setSenderFromId($externalId);
    return $externalClient;
}
```

This class extends from the class HyperChatClient that extends from the default HyperChatClient 
provided by the product team, and all the parent methods can be overwritten.

**Utils**

HTMLTablesToImage is used to transform HTML Tables into images from the Chatbot API content.
It can handle basics tables and transform them in a base64 image. It is used in the MicrosoftTeamsDigester when transforming chatbot
API into Teams API format.
